/*!1.0.2 kooboy_li@163.com*/
import t from"../../lib/magix.js";let e="https://jirenguapi.applinzi.com/fm",i=[],s=[];export default Object.assign({_T:()=>fetch(`${e}/getChannels.php`).then(t=>t.json()),_U:t=>fetch(`${e}/getSong.php?channel=${t}`).then(t=>t.json()),_S:t=>fetch(`${e}/getLyric.php?sid=${t}`).then(t=>t.json()),async _o(){let{channels:t}=await this._T();return{active:t[0],channels:t}},_X(){if(!this._V){let t=new Audio;t.onerror=(()=>{this.fire("_s")}),t.onended=(()=>{this.fire("_t")}),t.ontimeupdate=(()=>{let e=t.buffered,i=0;e.length&&(i=e.end(e.length-1)/t.duration),this.fire("_M",{duration:t.duration,current:t.currentTime,buffered:i})}),t.onplay=(()=>{this.fire("_u",{play:!0})}),t.onpause=(()=>{this.fire("_u",{play:t.ended})}),t.onloadedmetadata=(()=>{let t=this._W,e=!1;for(let i of s)if(i.sid==t.sid){e=!0;break}if(!e)for(let s of i)if(s.sid==t.sid){e=!0;break}e||s.push(t),s.length>50&&s.shift(),this.fire("_v",{song:t})}),this._V=t}},_Y(t){this._X(),this._V.src=t.url,this._V.play().catch(t=>{}),this._W=t},_Z(t){let e=this._V.seekable,i=e.length;if(i){let s=e.start(0),h=e.end(i-1);t>=s&&t<=h&&(this._V.currentTime=t)}else{let t=this._V.buffered;if(t.length){let e=t.end(t.length-1);this._V.currentTime=e}}},async _q(t,e){if(e||(e=0==i.length),e)try{let{song:i}=await this._U(t);this._Y(i[0]),this.fire("_w",{song:i[0]})}catch(i){this._q(t,e)}else{let t=i.pop();s.push(t),this._Y(t),this.fire("_w",{song:t})}},_H(){if(s.length>1){let t=s.pop();i.push(t),t=s[s.length-1],this._Y(t),this.fire("_w",{song:t})}},_z:()=>s.length>1,_D(t){this._V.volume=t},_A(){this._V.pause()},_B(){this._V.play()},_r(){this._V.currentTime=0,this._V.play()},_x(){if(s.length>1){let t=s[s.length-2];return"\u4e0a\u4e00\u9996\uff1a"+t.title+"-"+t.artist}return"\u4e0a\u4e00\u9996\uff1a\u6682\u65e0\u5386\u53f2\u6b4c\u66f2"},_y(){if(i.length){let t=i[i.length-1];return"\u4e0b\u4e00\u9996\uff1a"+t.title+"-"+t.artist}return"\u4e0b\u4e00\u9996\uff1a\u968f\u673a\u6b4c\u66f2"}},t.Event);